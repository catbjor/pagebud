<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Settings - PageBud</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=2025-08-28-1">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111111">
</head>

<body>
    <div class="app-container">
        <div class="stats-header">
            <div class="back-button" onclick="location.href='index.html'"><i class="fas fa-arrow-left"></i></div>
            <h1>Settings</h1>
            <div style="width:32px"></div>
        </div>

        <div class="content-wrapper">

            <!-- Appearance -->
            <div class="stats-section">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-palette"></i><span>Appearance</span></div>
                </div>

                <div class="theme-previews" id="themeGrid">
                    <!-- Default -->
                    <div class="theme-preview" data-theme="default">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#7BDFF2"></div>
                            <div class="color-swatch" style="background:#B4F8C8"></div>
                            <div class="color-swatch" style="background:#F7D6E0"></div>
                        </div>
                        <div class="theme-name">Pink & Blue</div>
                    </div>

                    <!-- Barbie -->
                    <div class="theme-preview" data-theme="barbie">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#FE9DD0"></div>
                            <div class="color-swatch" style="background:#8BD2F1"></div>
                            <div class="color-swatch" style="background:#F8C9EB"></div>
                        </div>
                        <div class="theme-name">Barbie</div>
                    </div>

                    <!-- Barbie Blue -->
                    <div class="theme-preview" data-theme="barbie-blue">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#57CAFC"></div>
                            <div class="color-swatch" style="background:#B3E6FF"></div>
                            <div class="color-swatch" style="background:#FFB6E6"></div>
                        </div>
                        <div class="theme-name">Barbie Blue</div>
                    </div>

                    <!-- Pink Classic -->
                    <div class="theme-preview" data-theme="pink-classic">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#FF9BC6"></div>
                            <div class="color-swatch" style="background:#F269A4"></div>
                            <div class="color-swatch" style="background:#E53781"></div>
                        </div>
                        <div class="theme-name">Pink Classic</div>
                    </div>

                    <!-- Soft Pink-Beige -->
                    <div class="theme-preview" data-theme="soft-pink-beige">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#F3B3CD"></div>
                            <div class="color-swatch" style="background:#F1C4A5"></div>
                            <div class="color-swatch" style="background:#F7DDCE"></div>
                        </div>
                        <div class="theme-name">Soft Pink-Beige</div>
                    </div>

                    <!-- Goth -->
                    <div class="theme-preview" data-theme="goth">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#3E2D36"></div>
                            <div class="color-swatch" style="background:#1E1E22"></div>
                            <div class="color-swatch" style="background:#5C3F49"></div>
                        </div>
                        <div class="theme-name">Goth</div>
                    </div>

                    <!-- Dark Academia -->
                    <div class="theme-preview" data-theme="dark-academia">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#1c1c1c"></div>
                            <div class="color-swatch" style="background:#daddd8"></div>
                            <div class="color-swatch" style="background:#ecebe4"></div>
                        </div>
                        <div class="theme-name">Dark Academia</div>
                    </div>

                    <!-- Black & White -->
                    <div class="theme-preview" data-theme="black-white">
                        <div class="theme-colors">
                            <div class="color-swatch" style="background:#000"></div>
                            <div class="color-swatch" style="background:#EFF0EE"></div>
                            <div class="color-swatch" style="background:#F6D3DD"></div>
                        </div>
                        <div class="theme-name">Black & White</div>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div class="stats-section">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-bell"></i><span>Notifications (FCM)</span></div>
                </div>
                <button class="btn btn-primary full-width" id="enablePushBtn">Enable Push (FCM)</button>
                <div class="muted" style="margin-top:8px">Requires browser permission + your VAPID public key.</div>
            </div>

            <!-- Data -->
            <div class="stats-section">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-database"></i><span>Data</span></div>
                </div>
                <div class="settings-actions">
                    <button class="btn btn-secondary full-width" id="exportDataBtn"><i class="fas fa-download"></i>
                        Export All Data</button>
                    <button class="btn btn-secondary full-width" id="importDataBtn"><i class="fas fa-upload"></i> Import
                        Data</button>
                    <button class="btn btn-danger full-width" id="resetDataBtn"><i class="fas fa-trash"></i> Reset All
                        Data</button>
                </div>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item" onclick="location.href='index.html'"><i class="fas fa-book"></i> Library</div>
            <div class="nav-item" onclick="location.href='stats.html'"><i class="fas fa-chart-line"></i> Stats</div>
            <div class="nav-item" onclick="location.href='buddy-read.html'"><i class="fas fa-users"></i> Buddy Read
            </div>
            <div class="nav-item active"><i class="fas fa-cog"></i> Settings</div>
        </nav>
    </div>

    <!-- App -->
    <script src="firebase.js"></script>
    <script src="script.js?v=2025-08-28-1"></script>

    <!-- FCM -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>
    <script>
        const VAPID_PUBLIC_KEY = "BJuvG6f4DO9_FG-tk1h9gQ5Ry1yeU9CYcrnZ-qRcIAbn4BgNnG73dHur62WbtBu_t9-XqeTHuGmR7UsASZPe0_g";

        // Temavelger
        (function () {
            const grid = document.getElementById('themeGrid');
            const saved = localStorage.getItem('pb:theme') || 'default';
            document.documentElement.setAttribute('data-theme', saved);
            [...grid.children].forEach(x => x.classList.toggle('active', x.dataset.theme === saved));
            grid.addEventListener('click', e => {
                const card = e.target.closest('.theme-preview'); if (!card) return;
                const t = card.dataset.theme;
                localStorage.setItem('pb:theme', t);
                document.documentElement.setAttribute('data-theme', t);
                [...grid.children].forEach(x => x.classList.toggle('active', x === card));
            });
        })();

        // Enable push
        document.getElementById('enablePushBtn').addEventListener('click', async () => {
            try {
                const perm = await Notification.requestPermission();
                if (perm !== 'granted') { alert('Notifications blocked.'); return; }
                const messaging = firebase.messaging(); // krever at firebase.js er lastet (fikser "No Firebase App")
                // Henter token (firebase-messaging-sw.js plukkes automatisk opp)
                const token = await messaging.getToken({ vapidKey: VAPID_PUBLIC_KEY });
                if (!token) { alert('No token'); return; }
                const u = fb.auth.currentUser;
                if (u) {
                    await fb.db.collection('users').doc(u.uid).collection('webPushTokens')
                        .doc(token).set({ token, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                }
                alert('Push enabled ✓');
            } catch (e) {
                console.error(e); alert('Push feilet – se console');
            }
        });

        // Krev innlogging (for å kunne lagre token på bruker)
        requireAuth(() => { });
    </script>
</body>

</html>