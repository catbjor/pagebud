<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Settings – PageBud</title>
    <!-- Put this inline snippet in the <head> of EVERY page BEFORE style.css -->
    <script>
        (function () {
            // Apply immediately to avoid FOUC
            function resolve(raw) {
                if (raw === "system") {
                    return matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
                }
                return raw || "default";
            }
            var raw = localStorage.getItem("pb:theme") || "default";
            document.documentElement.setAttribute("data-theme", resolve(raw));
            document.documentElement.setAttribute("data-tone", "pastel");
        }());
    </script>


    <!-- Apply saved theme immediately (no FOUC) -->
    <script>document.documentElement.setAttribute("data-theme", localStorage.getItem("pb:theme") || "default");</script>

    <!-- Icons + App styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css" />

    <!-- Firebase (load but do NOT block DOM: use defer) -->
    <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <script defer src="firebase-config.js"></script>
    <script defer src="firebase-init.js?v=dev-1"></script>

    <!-- Page scripts (also deferred) -->
    <script defer src="reset-utils.js"></script>
    <script defer src="settings.js"></script>
    <script defer src="settings-timer.js"></script>
    <script defer src="nav.js"></script>
    <script defer src="timer.js"></script>
</head>

<body>
    <div class="app-container">
        <header class="header">
            <h1>Settings</h1>
            <!-- header actions via nav.js -->
        </header>

        <div class="container">
            <!-- THEME -->
            <section class="card">
                <h2>Theme</h2>
                <div class="muted" id="themeStatus" style="margin-bottom:10px">
                    Current: <b id="themeName">default</b>
                </div>
                <div id="themeGrid" class="theme-previews"></div>
                <div class="settings-actions" style="margin-top:12px">
                    <button class="btn" id="btnMatchSystem">Match system</button>
                </div>
            </section>

            <!-- TIMER -->
            <section class="card" style="margin-top:16px;padding:16px">
                <h2 style="margin-bottom:12px">Reading Timer</h2>

                <section class="section" style="padding:0">
                    <div class="section-header">
                        <div class="section-title" style="font-weight:800">
                            <i class="fa-solid fa-bullseye"></i> Daily reading goal
                        </div>
                    </div>
                    <p class="muted" style="margin-top:6px">Sett et daglig mål i minutter. Brukes i kalenderen og
                        statistikken.</p>
                    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-top:8px">
                        <input id="goalMin" type="number" min="0" max="300" step="5" style="width:90px;padding:8px" />
                        <input id="goalRange" type="range" min="0" max="300" step="5" style="flex:1;min-width:200px" />
                        <button id="goalSave" class="btn" type="button"
                            style="background:var(--primary);border-color:var(--primary);color:#000">Save</button>
                        <span id="goalStatus" class="muted"></span>
                    </div>
                </section>

                <div class="section" style="padding:0;margin-top:12px">
                    <label style="font-weight:600">Dock side</label>
                    <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
                        <label style="display:flex;gap:6px;align-items:center;cursor:pointer"><input type="radio"
                                name="pb-timer-side" value="left" /> Left</label>
                        <label style="display:flex;gap:6px;align-items:center;cursor:pointer"><input type="radio"
                                name="pb-timer-side" value="right" /> Right</label>
                    </div>
                    <div class="muted" style="margin-top:6px">Flytt timer-docken til venstre eller høyre.</div>
                </div>

                <div class="section" style="padding:0;margin-top:12px">
                    <label style="font-weight:600;display:flex;align-items:center;gap:8px;cursor:pointer">
                        <input id="pb-timer-collapsed" type="checkbox" /> Start collapsed (kun klokke-ikon)
                    </label>
                    <div class="muted" style="margin-top:6px">Når påslått: timeren starter skjult og vises først når du
                        trykker på klokke-ikonet.</div>
                </div>

                <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
                    <button id="pb-timer-apply" class="btn" type="button"
                        style="background:var(--primary);border-color:var(--primary);color:#000">Apply now</button>
                    <button id="pb-timer-toggle" class="btn" type="button">Show/Hide now</button>
                    <button id="pb-timer-reset" class="btn" type="button"
                        style="background:#ff6b6b;border-color:#ff6b6b;color:#000">Reset timer state</button>
                </div>
            </section>

            <!-- RESET -->
            <section class="card" style="margin-top:16px">
                <h2>Reset cache</h2>
                <p class="muted">Bruk hvis appen ikke oppdateres pga. PWA cache. “Full reset” logger deg ut.</p>
                <div style="display:flex;gap:8px;flex-wrap:wrap">
                    <button class="btn" id="btnResetKeep">Reset caches (keep login)</button>
                    <button class="btn" id="btnResetFull">Full reset (sign out)</button>
                </div>
                <div id="resetStatus" class="muted" style="margin-top:8px"></div>
            </section>

            <!-- NOTIFICATIONS -->
            <section class="card" style="margin-top:16px">
                <h2>Notifications</h2>
                <p class="muted">Varsler for venneforespørsler og meldinger.</p>
                <button class="btn" id="btnEnablePush">Enable push</button>
                <div class="muted" id="pushStatus" style="margin-top:8px"></div>
            </section>

            <!-- ACCOUNT -->
            <section class="card" style="margin-top:16px">
                <h2>Account</h2>
                <button class="btn" id="btnLogout" style="background:#ff6b6b;border-color:#ff6b6b;color:#000">Log
                    out</button>
            </section>
        </div>
    </div>

    <div id="pb-toast" role="status" aria-live="polite"></div>

    <!-- Page-only helpers -->
    <script>
        // Safe logout button wiring
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("btnLogout")?.addEventListener("click", async () => {
                try { await fb.auth.signOut(); location.href = "auth.html"; }
                catch (e) { alert(e?.message || "Failed to log out"); }
            });
        });
    </script>
</body>

</html>