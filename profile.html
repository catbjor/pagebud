<!DOCTYPE html>
<html lang="en">

<head>
    <script src="theme-init.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Profile â€“ PageBud</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="profile.css" /> <!-- New CSS file for profile-specific styles -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-init.js"></script>
</head>

<body>
    <div class="app-container">
        <header class="header">
            <h1 id="profileHeaderTitle">Profile</h1>
            <div class="header-actions">
                <button class="back-fab" onclick="history.back()" title="Back">
                    <i class="fa fa-chevron-left"></i>
                </button>
            </div>
        </header>

        <main class="profile-content">
            <div class="profile-card">
                <div class="profile-header-actions">
                    <!-- Edit button will be shown here for own profile -->
                    <button id="btnCreateShelf" class="btn btn-secondary" style="display: none;"><i
                            class="fa-solid fa-plus"></i> New Shelf</button>
                    <button id="btnEditProfile" class="btn btn-secondary" style="display: none;">Edit Profile</button>
                </div>
                <div class="profile-photo-wrap">
                    <img id="profilePhoto"
                        src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                        alt="Profile photo">
                    <!-- Edit button shown only for own profile -->
                    <button id="btnChangePhoto" class="btn-change-photo" style="display: none;" title="Change photo">
                        <i class="fa fa-camera"></i>
                    </button>
                    <input type="file" id="photoInput" accept="image/*" style="display: none;">
                </div>
                <h2 id="profileName">Loading...</h2>
                <p id="profileUsername" class="muted"></p>

                <div id="bioContainer">
                    <p id="profileBio" class="bio-text"></p>
                    <div id="quirksContainer" class="quirks-container"></div>
                </div>

                <!-- Actions for viewing OTHER people's profiles -->
                <div id="otherUserActions" class="profile-actions" style="display: none;">
                    <button id="btnMessage" class="btn btn-primary">Message</button>
                    <button id="btnAddFriend" class="btn btn-secondary">Add Friend</button>
                    <button id="btnMoreOptions" class="btn-icon" title="More options">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                </div>

                <!-- Compatibility Score with another user (Corrected structure) -->
                <div id="compatibilityScore" class="compatibility-score" style="display: none;">
                    <div class="score-label">You & <span id="compFriendName"></span></div>
                    <div class="score-value-wrap">
                        <div class="score-value">--%</div>
                        <div class="score-title">Compatibility</div>
                    </div>
                    <div class="score-breakdown"></div>
                </div>

                <!-- Custom Shelves Section -->
                <div id="customShelvesContainer">
                </div>

                <!-- "Currently Reading" Shelf -->
                <section id="currentlyReadingShelf" class="profile-shelf card" style="display: none;">
                    <div class="card-head">
                        <h3>Currently Reading</h3>
                        <a href="index.html?filter=reading" class="btn btn-secondary see-all-btn"
                            style="display: none; padding: 4px 10px; font-size: .85rem;">See All</a>
                    </div>
                    <div class="shelf-grid"></div>
                </section>

                <!-- "Favorites" Shelf -->
                <section id="favoritesShelf" class="profile-shelf card" style="display: none;">
                    <div class="card-head">
                        <h3>Favorites</h3>
                        <a href="index.html?filter=favorites" class="btn btn-secondary see-all-btn"
                            style="display: none; padding: 4px 10px; font-size: .85rem;">See All</a>
                    </div>
                    <div class="shelf-grid"></div>
                </section>

                <!-- "Finished Books" Shelf -->
                <section id="finishedShelf" class="profile-shelf card" style="display: none;">
                    <div class="card-head">
                        <h3>Finished Books</h3>
                        <a href="index.html?filter=finished" class="btn btn-secondary see-all-btn"
                            style="display: none; padding: 4px 10px; font-size: .85rem;">See All</a>
                    </div>
                    <div class="shelf-grid"></div>
                </section>

                <!-- "Wishlist" Shelf -->
                <section id="wishlistShelf" class="profile-shelf card" style="display: none;">
                    <div class="card-head">
                        <h3>Wishlist</h3>
                        <a href="index.html?filter=wishlist" class="btn btn-secondary see-all-btn"
                            style="display: none; padding: 4px 10px; font-size: .85rem;">See All</a>
                    </div>
                    <div class="shelf-grid"></div>
                </section>

                <!-- Edit form for OWN profile -->
                <div id="editProfileSection" class="card" style="display: none;">
                    <h3>Edit Your Profile</h3>
                    <div class="form-row">
                        <label for="editName">Display Name</label>
                        <input type="text" id="editName" placeholder="Your name" />
                    </div>
                    <div class="form-row">
                        <label for="editQuirks">Reading Quirks</label>
                        <div class="categories picker-grid" id="editQuirks">
                        </div>
                    </div>
                    <div class="form-row">
                        <label for="editBio">Your Bio</label>
                        <textarea id="editBio" rows="4" placeholder="Tell us a little about yourself..."></textarea>
                    </div>
                    <button id="btnSaveChanges" class="btn btn-primary">Save Changes</button>
                </div>

                <!-- Achievements -->
                <section id="achievementsSection" class="profile-shelf card" style="display: none;">
                    <div class="card-head">
                        <h3>Achievements</h3>
                    </div>
                    <div id="achievementsGrid" class="achievements-grid"></div>
                </section>

                <!-- Badges for Completed Challenges -->
                <section id="badgesSection" class="profile-shelf card" style="display: none;">
                    <div class="card-head">
                        <h3>Badges</h3>
                    </div>
                    <div id="badgesGrid" class="badges-grid"></div>
                </section>
        </main>

        <!-- New Section for Notes & Quotes -->
        <section id="notesAndQuotesSection" class="card" style="display: none; margin: 16px;">
            <div class="card-head">
                <h3 style="margin:0">My Notes & Quotes</h3>
                <input type="search" id="notesSearchInput" placeholder="Search notes..." style="max-width: 250px;">
            </div>
            <div id="notesAndQuotesList">
                <!-- Notes will be injected here -->
            </div>
        </section>

        <!-- Modal for Shareable Quote Card -->
        <div id="quoteCardModal" class="modal-backdrop" style="align-items:center; justify-content:center;">
            <div class="modal-sheet" style="max-width: min(90vw, 450px); bottom: auto;">
                <h3>Your Quote Card</h3>
                <div id="quoteCardCanvasWrap"
                    style="margin: 16px 0; background: var(--surface); padding: 10px; border-radius: 8px;">
                    <!-- Canvas will be injected here -->
                    <p class="muted">Generating card...</p>
                </div>
                <div class="modal-actions" style="flex-direction: column; gap: 10px;">
                    <a id="downloadQuoteCardBtn" class="btn btn-primary" download="pagebud-quote.png">
                        <i class="fa-solid fa-download"></i> Download Image
                    </a>
                    <button id="closeQuoteCardBtn" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>

    </div>

    <template id="book-card-template">
        <article class="book-card">
            <div class="thumb-wrap">
                <img class="thumb" src="" alt="" />
                <span class="rated-badge" style="display: none;">
                    <img class="star" src="icons/yellow-star.svg" alt="" aria-hidden="true" />
                    <span class="val"></span>
                </span>
                <button type="button" class="heart-btn" data-action="fav" title="Favorite">
                    <i class="fa-regular fa-heart"></i>
                </button>
            </div>
            <div class="title"></div>
            <div class="author"></div>
            <div class="card-ratings">
                <div class="card-row rating-stars" aria-label="rating"></div>
                <div class="card-row spice-chilis" aria-label="spice"></div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" data-action="open">
                    <i class="fa fa-pen"></i> Edit
                </button>
                <button class="btn" data-action="read" style="display: none;">
                    <i class="fa fa-book-open"></i> Read
                </button>
            </div>
        </article>
    </template>

    <script src="nav.js" defer></script>
    <script src="profile-page.js" defer></script> <!-- New JS file -->
</body>

</html>