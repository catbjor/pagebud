<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>PageBud</title> <!-- Theme -->
  <script src="theme-init.js"></script> <!-- Styles -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <link href="style.css?v=cards2" rel="stylesheet" /> <!-- Firebase -->
  <style>
    .loader {
      border: 5px solid var(--surface, #f3f3f3);
      border-top: 5px solid var(--primary, #2f4156);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Book card fade-in animation */
    .book-card {
      opacity: 0;
      transform: translateY(15px);
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }

    .book-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Arrange book card action buttons side-by-side */
    .book-card .actions {
      display: flex;
      gap: 8px;
    }

    .book-card .actions .btn {
      flex: 1;
      /* Make buttons share space equally */
    }

    /* Robust modal styles for the shelf selector */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: none;
      /* Hidden by default */
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease-in-out;
    }

    .modal-backdrop.show {
      display: flex;
      opacity: 1;
    }

    .modal-backdrop .modal-sheet {
      transform: scale(0.95);
      opacity: 0;
      transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out;
    }

    .modal-backdrop.show .modal-sheet {
      transform: scale(1);
      opacity: 1;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="firebase-init.js"></script>
  <script src="home-friends-feed.js" defer></script>
</head>

<body>
  <div class="app-container">
    <header class="header">
      <div class="title-stack">
        <h1 class="page-title">PageBud</h1>
        <div id="homeGreeting" class="page-subtle"></div>
      </div>
      <div class="header-actions"></div>
    </header>
    <div class="categories scroll-x" id="filter-chips">
      <div class="category active" data-filter="all">All Books</div>
      <div class="category" data-filter="favorites">Favorites</div>
      <div class="category" data-filter="reading">Reading</div>
      <div class="category" data-filter="finished">Finished</div>
      <div class="category" data-filter="tbr">TBR</div>
      <div class="category" data-filter="dnf">DNF</div>
      <div class="category" data-filter="owned">Owned</div>
      <div class="category" data-filter="wishlist">Wishlist</div>
    </div>
    <div class="toolbar"> <input id="search-input" placeholder="Search by title or author..." type="search" />
      <div class="toolbar-controls">
        <div class="theme-toggle">
          <button id="btnThemeLight" class="btn" title="Light mode"><i class="fa-solid fa-sun"></i></button>
          <button id="btnThemeDark" class="btn" title="Dark mode"><i class="fa-solid fa-moon"></i></button>
        </div>
        <div class="view-toggle" id="viewToggle">
          <button class="btn active" id="viewGrid" data-view="grid">Grid</button>
          <button class="btn" id="viewList" data-view="list">List</button>
        </div>
      </div>
    </div>
    <!-- Header for shelf management view -->
    <div id="shelfManagementHeader" class="card" style="display:none; margin: 0 16px 16px;"></div>

    <section class="pad">
      <div class="card">
        <div class="card-head">
          <h2>My Library</h2>
        </div>
        <div class="books-grid" id="books-grid"></div>
        <div class="muted small" id="empty-state" style="display:none;padding:12px"> Your library is empty. Tap + to add
          a book. </div>
      </div>
    </section> <!-- Social Feed Preview -->
    <section class="pad" id="social-feed-preview-section">
      <div class="card">
        <div class="card-head">
          <h2>Friends Activity</h2> <a href="feed.html" class="btn btn-secondary"
            style="padding: 4px 10px; font-size: .85rem;">See all</a>
        </div>
        <div id="social-feed-preview-container" style="padding: 0 12px 12px;">
          <!-- Preview content will be injected here by social-feed-preview.js -->
        </div>
      </div>
    </section> <button aria-label="Add Book" class="add-book" id="add-book-btn" onclick="location.href='add-book.html'"
      title="Add Book" type="button"><i class="fas fa-plus"></i></button>
    <!-- Multi-select Action Bar -->
    <div id="multiSelectBar" class="multi-select-bar">
      <button id="cancelSelectBtn" class="btn btn-secondary">Cancel</button>
      <div id="selectCount" class="select-count">0 books selected</div>
      <button id="addToShelfBtn" class="btn btn-secondary" disabled><i class="fa-solid fa-plus"></i> Add to
        Shelf</button>
      <button id="removeFromShelfBtn" class="btn btn-warning" disabled style="display: none;"><i
          class="fa-solid fa-minus"></i> Remove from Shelf</button>
      <button id="deleteSelectedBtn" class="btn btn-danger" disabled>Delete</button>
    </div>
  </div> <!-- Scripts -->
  <!-- Modal for Selecting a Shelf -->
  <div id="shelfSelectModal" class="modal-backdrop" style="align-items:center; justify-content:center;">
    <div class="modal-sheet" style="max-width: min(90vw, 400px); bottom: auto;">
      <h3>Add to Shelf</h3>
      <div id="shelfSelectList" class="results-list" style="max-height: 50vh; overflow-y: auto;">
        <!-- Shelf list will be injected here -->
      </div>
      <button id="closeShelfModalBtn" class="btn btn-secondary" style="margin-top: 16px; width: 100%;">Cancel</button>
    </div>
  </div>

  <template id="book-card-template">
    <article class="book-card">
      <div class="thumb-wrap">
        <img class="thumb" src="" alt="" />
        <span class="rated-badge" style="display: none;">
          <img class="star" src="icons/yellow-star.svg" alt="" aria-hidden="true" />
          <span class="val"></span>
        </span>
        <button type="button" class="heart-btn" data-action="fav" title="Favorite">
          <i class="fa-regular fa-heart"></i>
        </button>
      </div>
      <div class="card-body">
        <div class="title"></div>
        <div class="author"></div>
        <div class="card-ratings">
          <div class="card-row rating-stars" aria-label="rating"></div>
          <div class="card-row spice-chilis" aria-label="spice"></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn btn-secondary" data-action="open">
          <i class="fa fa-pen"></i> Edit
        </button>
        <button class="btn" data-action="read" style="display: none;">
          <i class="fa fa-book-open"></i> Read
        </button>
      </div>
    </article>
  </template>

  <script src="reset-utils.js"></script>
  <script src="nav.js" defer></script>
  <script src="activity.js" defer></script>
  <script src="social-feed.js" defer></script>
  <script src="script.js" defer></script>
  <script src="toast.js" defer></script>
  <script src="sync.js" defer></script>
  <script src="social-feed-preview.js" defer></script>
  <script src="i18n.js?v=1" defer></script>
  <script src="header-actions.js" defer></script>
  <script src="index-actions.js?v=greet3" defer></script>
  <script src="goal-badge.js" defer></script>
  <script src="shelf-actions.js" defer></script> <!-- New script for shelf actions -->
  <script src="multi-select.js" defer></script>
  <script src="library-enricher.js" defer></script>
  <script src="toolbar-controls.js" defer></script>
  <script> requireAuth(() => { if (window.renderSocialFeedPreview) { window.renderSocialFeedPreview(); } }); </script>
</body>

</html>