/* ===========================================================
   PageBud – Global styles (mobile-first, de-duplicated)
   =========================================================== */

/* ---------- Base tokens (fallbacks) ---------- */
:root {
  --background: #0f0f12;
  --text: #eaeaf0;
  --text-light: #b9bcc3;
  --card: #17181d;
  --border: #262832;
  --surface: #1b1d23;
  --hover: #1f222a;
  --primary: #7BDFF2;
  --secondary: #B4F8C8;
  --accent: #F7D6E0;

  --primary-soft: color-mix(in oklab, var(--primary) 18%, transparent);
  --primary-ink: #05212a;
  --bg-elev-1: #14161b;

  --bottom-nav-h: 64px;
}

/* ===========================================================
   Pastel tone mapper
   Define three swatches per theme:
     --c1 (lightest) → background
     --c2 (mid)      → secondary/surfaces
     --c3 (darkest)  → primary/text
   =========================================================== */
:root[data-tone="pastel"] {
  /* background & surfaces built from --c1 */
  --background: var(--c1);
  --card: color-mix(in oklab, var(--c1) 92%, #000 8%);
  --surface: color-mix(in oklab, var(--c1) 88%, #000 12%);
  --hover: color-mix(in oklab, var(--c1) 84%, #000 16%);
  --border: color-mix(in oklab, var(--c1) 70%, #000 30%);
  --bg-elev-1: color-mix(in oklab, var(--c1) 82%, #000 18%);

  /* readable text from the darkest swatch */
  --text: color-mix(in oklab, var(--c3) 88%, #000 12%);
  --text-light: color-mix(in oklab, var(--c3) 60%, #000 40%);

  /* brand roles */
  --primary: var(--c3);
  --secondary: var(--c2);
  --accent: var(--c1);
  --primary-soft: color-mix(in oklab, var(--primary) 18%, transparent);
  --primary-ink: #0c0c0c;
}

/* ===========================================================
   Theme swatches (ONLY --c1/--c2/--c3)
   =========================================================== */

/* Basics */
:root[data-theme="default"] {
  --c1: #F7D6E0;
  --c2: #B4F8C8;
  --c3: #7BDFF2;
}

:root[data-theme="light"] {
  --c1: #ffffff;
  --c2: #e2e8f0;
  --c3: #0f172a;
}

:root[data-theme="dark"] {
  --c1: #eaeaf0;
  --c2: #6aa8ff;
  --c3: #0c0d10;
}

:root[data-theme="amoled"] {
  --c1: #e9eef5;
  --c2: #7aa7ff;
  --c3: #000000;
}

:root[data-theme="black-white"] {
  --c1: #ffffff;
  --c2: #cbd5e1;
  --c3: #000000;
}

/* Your palettes (pastel-first) */
:root[data-theme="cotton-candy"] {
  --c1: #FFD3DD;
  --c2: #F0F9F8;
  --c3: #F3A2BE;
}

:root[data-theme="hot-pink"] {
  --c1: #FBD9E5;
  --c2: #EE7ABF;
  --c3: #EE2A7B;
}

:root[data-theme="mint-frost"] {
  --c1: #C6E6E3;
  --c2: #ABDCD9;
  --c3: #81BFB7;
}

:root[data-theme="granite-beige"] {
  --c1: #F6ECE3;
  --c2: #B7A7A9;
  --c3: #91766E;
}

:root[data-theme="soft-neutrals"] {
  --c1: #FAFAFF;
  --c2: #DADDD8;
  --c3: #1C1C1C;
}

:root[data-theme="moss-forest"] {
  --c1: #DADED8;
  --c2: #768064;
  --c3: #2C3424;
}

:root[data-theme="navy-teal"] {
  --c1: #C8D9E6;
  --c2: #567C8D;
  --c3: #2F4156;
}

:root[data-theme="dark-romance"] {
  --c1: #F2F1ED;
  --c2: #B38F6F;
  --c3: #710014;
}

:root[data-theme="goth-mauve"] {
  --c1: #EEE9F0;
  --c2: #9B8791;
  --c3: #5A4B5B;
}

:root[data-theme="lime-pop"] {
  --c1: #FFD9F8;
  --c2: #FF7ABF;
  --c3: #CDFF30;
}

:root[data-theme="sunset-peach"] {
  --c1: #FEC6A3;
  --c2: #F3C4BE;
  --c3: #EC8366;
}

:root[data-theme="halloween-spice"] {
  --c1: #EEE7E0;
  --c2: #5D4F46;
  --c3: #F47421;
}

:root[data-theme="terracotta-olive"] {
  --c1: #CFC4B1;
  --c2: #676127;
  --c3: #935727;
}

:root[data-theme="autumn-pastel"] {
  --c1: #F5E7E1;
  --c2: #E3E5F2;
  --c3: #F6CFA3;
}

:root[data-theme="navy-gold"] {
  --c1: #F0EBDB;
  --c2: #C9A6A1;
  --c3: #C79466;
}

/* ===========================================================
   Base layout & components (unchanged)
   =========================================================== */

* {
  box-sizing: border-box;
}

html,
body {
  height: 100%;
}

body {
  margin: 0;
  font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
  color: var(--text);
  background: var(--background);
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  padding-bottom: calc(var(--bottom-nav-h) + env(safe-area-inset-bottom, 0px));
}

/* Typography */
h1,
h2,
h3 {
  margin: 0 0 .6rem;
  font-weight: 800;
}

h1 {
  font-size: 1.6rem;
}

h2 {
  font-size: 1.25rem;
}

h3 {
  font-size: 1.1rem;
}

p {
  margin: .5rem 0;
}

a {
  color: var(--primary);
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

button,
.btn,
input,
select {
  font: inherit;
  color: var(--text);
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: .6rem .9rem;
  cursor: pointer;
}

button:hover,
.btn:hover {
  border-color: var(--primary);
}

input[type="search"],
input[type="text"] {
  width: 100%;
}

/* Layout */
.app-container {
  min-height: 100vh;
  position: relative;
  padding-bottom: calc(var(--bottom-nav-h) + 28px + env(safe-area-inset-bottom))
}

.container {
  max-width: 980px;
  margin: 0 auto;
  padding: 16px;
}

/* Header */
.header {
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 16px;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  box-shadow: 0 2px 10px rgba(0, 0, 0, .06);
}

.header-actions {
  display: flex;
  gap: 8px;
}

/* Back FAB */
.back-fab {
  position: fixed;
  top: env(safe-area-inset-top, 12px);
  left: 12px;
  z-index: 60;
  display: inline-grid;
  place-items: center;
  width: 40px;
  height: 40px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--card) 80%, transparent);
  border: 1px solid var(--border);
  color: var(--text);
  box-shadow: 0 6px 20px rgba(0, 0, 0, .25);
}

.back-fab:active {
  transform: scale(.98);
}

/* Cards / sections */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, .12);
}

.section {
  padding: 16px;
}

/* Categories (chips) */
.categories {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 12px 16px;
  margin: 10px 0;
}

.scroll-x {
  overflow: auto;
  scroll-snap-type: x proximity;
}

.category {
  display: inline-flex;
  align-items: center;
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: var(--surface);
  font-weight: 800;
  font-size: .95rem;
  cursor: pointer;
  user-select: none;
  transition: transform .02s;
}

.category:active {
  transform: scale(.98);
}

.category.active {
  background: var(--primary-soft);
  color: var(--primary-ink);
  border-color: var(--primary);
  box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 25%, transparent);
}

/* Library grid */
.library {
  padding: 0 16px 16px;
}

.book-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
}

.empty-state {
  display: grid;
  justify-items: center;
  gap: 8px;
  padding: 24px;
  border: 1px dashed var(--border);
  border-radius: 14px;
}

.empty-icon {
  font-size: 28px;
  color: var(--text-light);
}

/* Floating Add */
.add-book {
  position: fixed;
  right: 18px;
  bottom: calc(var(--bottom-nav-h) + 18px + env(safe-area-inset-bottom, 0px));
  width: 56px;
  height: 56px;
  border-radius: 999px;
  background: var(--primary);
  color: #0c0c0c;
  display: grid;
  place-items: center;
  border: none;
  box-shadow: 0 10px 26px rgba(0, 0, 0, .25);
  font-size: 22px;
}

/* Bottom nav */
.bottom-nav {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  height: var(--bottom-nav-h);
  backdrop-filter: blur(8px);
  background: color-mix(in oklab, var(--card) 85%, transparent);
  border-top: 1px solid var(--border);
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  align-items: center;
  z-index: 2000;
}

.nav-item {
  display: grid;
  place-items: center;
  gap: 4px;
  height: 100%;
  color: var(--text-light);
  font-size: 12px;
  user-select: none;
}

.nav-item i {
  font-size: 18px;
  line-height: 1;
}

.nav-item.active {
  color: var(--primary);
  font-weight: 800;
}

/* Streak */
.streak-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.streak-card {
  padding: 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: var(--surface);
}

.streak-val {
  font-size: 1.4rem;
  font-weight: 900;
}

.muted {
  color: var(--text-light);
}

/* Timer Dock */
.timer-dock {
  position: fixed;
  bottom: calc(var(--bottom-nav-h) + 84px + env(safe-area-inset-bottom, 0px));
  left: 18px;
  z-index: 2100;
  display: grid;
  grid-auto-flow: column;
  align-items: center;
  gap: 8px;
  background: color-mix(in oklab, var(--card) 92%, transparent);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 8px 10px;
  box-shadow: 0 10px 26px rgba(0, 0, 0, .25);
  -webkit-tap-highlight-color: transparent;
}

.timer-dock.right {
  left: auto;
  right: 18px;
}

.timer-time {
  font-weight: 900;
  letter-spacing: .5px;
  min-width: 84px;
  text-align: center;
}

.timer-btn {
  width: 36px;
  height: 36px;
  display: grid;
  place-items: center;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--surface);
  font-size: 16px;
  cursor: pointer;
}

.timer-btn.primary {
  background: var(--primary);
  border-color: var(--primary);
  color: #0b0b0b;
}

.timer-btn:active {
  transform: scale(.97);
}

.timer-dock.collapsed {
  padding: 6px 8px;
}

.timer-dock.collapsed .timer-time,
.timer-dock.collapsed .timer-btn[data-role="pause"],
.timer-dock.collapsed .timer-btn[data-role="resume"],
.timer-dock.collapsed .timer-btn[data-role="stop"] {
  display: none;
}

/* Fixed form action bar */
.form-actions-fixed {
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: calc(var(--bottom-nav-h) + env(safe-area-inset-bottom) + 12px);
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
  background: color-mix(in oklab, var(--card) 85%, transparent);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  z-index: 1900;
  backdrop-filter: blur(10px);
}

.form-actions-fixed .btn {
  height: 38px;
}

/* Progress mini */
.progress-mini {
  margin-top: 6px;
}

.progress-mini .bar {
  height: 6px;
  border-radius: 999px;
  overflow: hidden;
  background: var(--bg-elev-1);
  border: 1px solid var(--border);
}

.progress-mini .fill {
  height: 100%;
  width: 0;
  background: var(--primary);
  transition: width .25s ease;
}

.progress-mini .label {
  font-size: .8rem;
  opacity: .8;
  margin-top: 4px;
}

/* Cover shimmer */
.cover-wrap {
  width: 100%;
  height: 180px;
  border-radius: 12px;
  overflow: hidden;
  background: var(--surface);
}

.cover {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.shimmer {
  position: relative;
  overflow: hidden;
}

.shimmer::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(110deg, rgba(255, 255, 255, .06) 8%, rgba(255, 255, 255, .18) 18%, rgba(255, 255, 255, .06) 33%);
  background-size: 200% 100%;
  animation: pbShimmer 1.1s linear infinite;
}

@keyframes pbShimmer {
  to {
    background-position-x: -200%;
  }
}

@media (prefers-reduced-motion:reduce) {
  .shimmer::after {
    animation: none !important;
  }
}

/* Chips (generic) */
.chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: var(--card);
  cursor: pointer;
  user-select: none;
}

.chip.active {
  background: var(--primary-soft);
  color: var(--primary-ink);
  border-color: var(--primary);
  font-weight: 700;
}

/* Rating icons (kept) */
.rating,
.spice {
  display: flex;
  gap: 8px;
  align-items: center;
}

.icon-btn {
  width: 28px;
  height: 28px;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
}

.icon-btn img,
.icon-btn svg {
  width: 100%;
  height: 100%;
  display: block;
}

.star .outline {
  stroke: #b18c00;
  stroke-width: 2;
  fill: none;
}

.star .fill {
  fill: #f2c200;
  display: none;
}

.star.active .fill {
  display: block;
}

.star.sixth.active .fill {
  fill: #b88400;
}

.star.sixth.active.pulse {
  animation: pb-pulse .35s ease-out;
}

@keyframes pb-pulse {
  0% {
    transform: scale(.82)
  }

  100% {
    transform: scale(1)
  }
}

.chili .outline {
  stroke: #e11d48;
  stroke-width: 2;
  fill: none;
}

.chili .fill {
  fill: transparent;
}

.chili.active .fill {
  fill: #e11d48;
}

.actions {
  z-index: 1700;
  pointer-events: auto;
}

.card,
.form-grid {
  position: relative;
}

/* Theme preview grid */
.theme-previews {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 10px;
}

.theme-preview {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, .04);
  cursor: pointer;
  user-select: none;
  outline: none;
}

.theme-preview:active {
  transform: scale(.99);
}

.theme-preview .theme-colors {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
}

.theme-preview .color-swatch {
  flex: 1;
  height: 18px;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.theme-preview .theme-name {
  font-weight: 800;
  font-size: .95rem;
  color: var(--text);
}

.theme-preview.active {
  border-color: var(--primary);
  box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 28%, transparent);
}

/* Responsive */
@media (min-width:1024px) {
  .book-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
  }

  .category {
    padding: 12px 16px;
    border-radius: 14px;
  }
}

@media (max-width:380px) {
  .timer-dock {
    bottom: calc(var(--bottom-nav-h) + 74px + env(safe-area-inset-bottom, 0px));
  }

  .timer-time {
    min-width: 72px;
    font-size: .95rem;
  }
}

/* --- Remove shimmer globally (keep markup; no visual effect) --- */
.shimmer::after {
  display: none !important;
}

/* --- Ensure review area clears the bottom nav --- */
.review-box {
  margin-bottom: calc(var(--bottom-nav-h) + 16px);
}

/* --- Make form sections breathe on small screens --- */
@media (max-width: 480px) {
  .form-grid {
    display: grid;
    gap: 10px;
  }

  .card {
    padding: 10px;
  }
}