<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign in – PageBud</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="auth.css">

    <!-- Firebase compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>


    <!-- Bootstrap our global fb helper -->
    <script src="firebase-init.js"></script>
</head>

<body style="background:#fff;">
    <div class="auth-shell">
        <div class="auth-card">
            <h1 class="auth-title">PageBud</h1>

            <button id="googleBtn" class="btn btn-google">
                <i class="fab fa-google"></i> Sign in with Google
            </button>

            <div class="auth-sep"><span>or</span></div>

            <form id="emailForm" class="auth-form">
                <label>Email</label>
                <input id="email" type="email" required placeholder="you@example.com" />

                <label>Password</label>
                <input id="password" type="password" minlength="6" required placeholder="••••••••" />

                <div class="row">
                    <button type="submit" class="btn btn-primary">Sign in</button>
                    <button type="button" id="createBtn" class="btn btn-muted">Create account</button>
                </div>
            </form>

            <p class="muted small" style="margin-top:10px">
                Trouble signing in? Make sure your domain is whitelisted in Firebase → Auth → Settings → Authorized
                domains.
            </p>
        </div>
    </div>

    <script>
        // --- Auth handlers (runs AFTER firebase-init.js, so fb is defined) ---
        const emailEl = document.getElementById("email");
        const passEl = document.getElementById("password");

        document.getElementById("googleBtn").addEventListener("click", async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await fb.auth.signInWithPopup(provider);
                location.href = "index.html";
            } catch (e) {
                alert(e.message || "Google sign-in failed");
            }
        });

        document.getElementById("emailForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            try {
                await fb.auth.signInWithEmailAndPassword(emailEl.value.trim(), passEl.value);
                location.href = "index.html";
            } catch (e) {
                alert(e.message || "Sign in failed");
            }
        });

        document.getElementById("createBtn").addEventListener("click", async () => {
            try {
                await fb.auth.createUserWithEmailAndPassword(emailEl.value.trim(), passEl.value);
                location.href = "index.html";
            } catch (e) {
                alert(e.message || "Create account failed");
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>
</body>

</html>