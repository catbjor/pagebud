<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign in â€“ PageBud</title>
    <!-- Put this inline snippet in the <head> of EVERY page BEFORE style.css -->
    <script>
        (function () {
            // Apply immediately to avoid FOUC
            function resolve(raw) {
                if (raw === "system") {
                    return matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
                }
                return raw || "default";
            }
            var raw = localStorage.getItem("pb:theme") || "default";
            document.documentElement.setAttribute("data-theme", resolve(raw));
            document.documentElement.setAttribute("data-tone", "pastel");
        }());
    </script>


    <!-- Base styles -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="auth.css" />

    <!-- Apply saved theme -->
    <script>
        document.documentElement.setAttribute("data-theme", localStorage.getItem("pb:theme") || "default");
    </script>

    <!-- 1) Firebase compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

    <script src="firebase-config.js"></script>
    <script src="firebase-init.js?v=dev-1"></script>
    <script src="profiles.js"></script>

    <!-- 2) ðŸ”§ Inline config -->
    <script>

        window.__PB_FIREBASE = {
            apiKey: "AIzaSyCEV-dncbQSnP7q9AvF2_Re93l-VHN-2cg",
            authDomain: "pagebud-cb6d9.firebaseapp.com",
            projectId: "pagebud-cb6d9",
            storageBucket: "pagebud-cb6d9.firebasestorage.app",
            messagingSenderId: "974455288174",
            appId: "1:974455288174:web:84d8a2e442ca193391d17f",
            measurementId: "G-TK4VCBT1V9"
        };
    </script>

    </script>
</head>

<body style="background: var(--background)">
    <div class="auth-shell">
        <div class="auth-card">
            <h1 class="auth-title">PageBud</h1>

            <!-- Google sign in -->
            <button id="googleBtn" class="btn btn-google">
                <i class="fab fa-google"></i> Sign in with Google
            </button>

            <div class="auth-sep"><span>or</span></div>

            <!-- Email/password form -->
            <form id="emailForm" class="auth-form">
                <label>Email</label>
                <input id="email" type="email" required placeholder="you@example.com" />

                <label>Password</label>
                <input id="password" type="password" minlength="6" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />

                <div class="row">
                    <button type="submit" class="btn btn-primary">Sign in</button>
                    <button type="button" id="createBtn" class="btn btn-muted">Create account</button>
                </div>
            </form>

            <p class="muted small" style="margin-top:10px">
                Trouble signing in? Make sure your domain is whitelisted in Firebase Auth â†’ Settings â†’ Authorized
                domains.
            </p>
        </div>
    </div>

    <script>
        // --- Auth handlers (runs AFTER firebase-init.js, so fb is defined) ---
        const emailEl = document.getElementById("email");
        const passEl = document.getElementById("password");

        // Google sign in
        document.getElementById("googleBtn").addEventListener("click", async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await fb.auth.signInWithPopup(provider);
                location.href = "index.html";
            } catch (e) {
                alert(e.message || "Google sign-in failed");
            }
        });

        // Email sign in
        document.getElementById("emailForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            try {
                await fb.auth.signInWithEmailAndPassword(emailEl.value.trim(), passEl.value);
                location.href = "index.html";
            } catch (e) {
                alert(e.message || "Sign in failed");
            }
        });

        // Create account
        document.getElementById("createBtn").addEventListener("click", async () => {
            try {
                await fb.auth.createUserWithEmailAndPassword(emailEl.value.trim(), passEl.value);
                location.href = "index.html";
            } catch (e) {
                alert(e.message || "Create account failed");
            }
        });
    </script>

    <!-- Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>
</body>

</html>